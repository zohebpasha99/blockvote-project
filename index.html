<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockVote - Blockchain Voting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --secondary: #6366f1;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: #f1f5f9;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        .blockchain-animation::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.8), 
                transparent);
            animation: blockchain-flow 3s linear infinite;
        }
        
        @keyframes blockchain-flow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .transaction-card {
            transition: all 0.3s ease;
        }
        
        .transaction-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        #resultsChart {
            max-height: 400px;
        }
    </style>
</head>
<body>
    <!-- Login/Signup Modal -->
    <div id="authModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Welcome to BlockVote</h2>
                <button onclick="closeAuthModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loginEmail">Email</label>
                    <input id="loginEmail" class="w-full px-3 py-2 border rounded-md" type="email" placeholder="your@email.com">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="loginPassword">Password</label>
                    <input id="loginPassword" class="w-full px-3 py-2 border rounded-md" type="password" placeholder="••••••••">
                </div>
                <button onclick="login()" class="w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 mb-4">
                    Login
                </button>
                <p class="text-center text-sm text-gray-600">
                    Don't have an account? 
                    <a href="#" onclick="showSignupForm()" class="text-blue-500 hover:text-blue-700">Sign up</a>
                </p>
            </div>

            <div id="signupForm" class="hidden">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="signupEmail">Email</label>
                    <input id="signupEmail" class="w-full px-3 py-2 border rounded-md" type="email" placeholder="your@email.com">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="signupPassword">Password</label>
                    <input id="signupPassword" class="w-full px-3 py-2 border rounded-md" type="password" placeholder="••••••••">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="confirmPassword">Confirm Password</label>
                    <input id="confirmPassword" class="w-full px-3 py-2 border rounded-md" type="password" placeholder="••••••••">
                </div>
                <button onclick="signup()" class="w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 mb-4">
                    Create Account
                </button>
                <p class="text-center text-sm text-gray-600">
                    Already have an account? 
                    <a href="#" onclick="showLoginForm()" class="text-blue-500 hover:text-blue-700">Login</a>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Navigation -->
    <nav class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="blockchain-animation flex-shrink-0 flex items-center">
                        <svg class="h-8 w-8 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        <span class="text-xl font-bold">BlockVote</span>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="connectWallet()" class="px-3 py-2 rounded-md text-sm font-medium bg-white text-blue-600">
                            Connect Wallet
                        </button>
                        <a href="#home" class="px-3 py-2 rounded-md text-sm font-medium bg-white text-blue-600">Home</a>
                        <a href="#vote" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700 hover:text-white">Vote</a>
                        <a href="#results" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700 hover:text-white">Results</a>
                    </div>
                </div>
                <div class="hidden md:block">
                    <button onclick="showAuthModal()" class="ml-4 px-4 py-2 bg-white text-blue-600 rounded-md text-sm font-medium hover:bg-blue-50">
                        Login
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="app" style="display: none;">
        <!-- Home Page -->
        <section id="home" class="py-12 px-4">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <h1 class="text-4xl font-bold text-gray-900 mb-4">Decentralized Voting Powered by Blockchain</h1>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        A secure, transparent and tamper-proof voting system built on blockchain technology.
                    </p>
                </div>

                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Current Elections</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Election</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidates</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10">
                                                <!-- Removed image tag -->
                                            </div>
                                            <div class="ml-4">
                                                <div class="text-sm font-medium text-gray-900">Student Union Election</div>
                                                <div class="text-sm text-gray-500">University of Blockchain</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Active</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">4 candidates</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="#vote" onclick="handleVoteNowClick(event)" class="text-blue-600 hover:text-blue-900">Vote Now</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10">
                                                <!-- Removed image tag -->
                                            </div>
                                            <div class="ml-4">
                                                <div class="text-sm font-medium text-gray-900">Community Board</div>
                                                <div class="text-sm text-gray-500">Blockchain Heights</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Coming Soon</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button disabled class="text-gray-400">Starts June 15</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Voting Page -->
        <section id="vote" class="py-12 px-4 bg-blue-50">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Student Union Election</h2>
                        <p class="text-gray-600">Cast your secure vote on the blockchain</p>
                        <div class="mt-4">
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-medium">
                                Active Until: June 30, 2023
                            </span>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Your Blockchain Wallet</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <span class="text-sm font-medium text-gray-500 mr-2">Wallet Address:</span>
                                <span class="text-sm font-mono text-gray-700" id="displayWalletAddress">N/A</span>
                            </div>
                            <div id="votingStatusContainer" class="flex items-center hidden">
                                <span class="text-sm font-medium text-gray-500 mr-2">Voting Status:</span>
                                <span class="text-sm font-medium text-green-600">Eligible to Vote</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Candidates</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="candidate-card bg-white border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="p-4 flex items-center">
                                    <div class="flex-shrink-0 h-16 w-16">
                                        <!-- Removed image tag -->
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="text-lg font-medium text-gray-900">Alice Chen</h4>
                                        <p class="text-sm text-gray-500" data-party="Finance Committee">Finance Committee</p>
                                    </div>
                                </div>
                                <div class="px-4 pb-4">
                                    <p class="text-sm text-gray-600 mb-4">Focus on budget transparency and student grants</p>
                                    <button onclick="selectCandidate('Alice Chen')" class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-blue-600 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Select
                                    </button>
                                </div>
                            </div>
                            
                            <div class="candidate-card bg-white border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="p-4 flex items-center">
                                    <div class="flex-shrink-0 h-16 w-16">
                                        <!-- Removed image tag -->
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="text-lg font-medium text-gray-900">David Martinez</h4>
                                        <p class="text-sm text-gray-500" data-party="Events Committee">Events Committee</p>
                                    </div>
                                </div>
                                <div class="px-4 pb-4">
                                    <p class="text-sm text-gray-600 mb-4">Plan more social events and student activities</p>
                                    <button onclick="selectCandidate('David Martinez')" class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-blue-600 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Select
                                    </button>
                                </div>
                            </div>
                            
                            <div class="candidate-card bg-white border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="p-4 flex items-center">
                                    <div class="flex-shrink-0 h-16 w-16">
                                        <!-- Removed image tag -->
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="text-lg font-medium text-gray-900">Priya Patel</h4>
                                        <p class="text-sm text-gray-500" data-party="Academic Affairs">Academic Affairs</p>
                                    </div>
                                </div>
                                <div class="px-4 pb-4">
                                    <p class="text-sm text-gray-600 mb-4">Advocate for curriculum improvements</p>
                                    <button onclick="selectCandidate('Priya Patel')" class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-blue-600 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Select
                                    </button>
                                </div>
                            </div>
                            
                            <div class="candidate-card bg-white border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
                                <div class="p-4 flex items-center">
                                    <div class="flex-shrink-0 h-16 w-16">
                                        <!-- Removed image tag -->
                                    </div>
                                    <div class="ml-4">
                                        <h4 class="text-lg font-medium text-gray-900">Jordan Taylor</h4>
                                        <p class="text-sm text-gray-500" data-party="Sustainability">Sustainability</p>
                                    </div>
                                </div>
                                <div class="px-4 pb-4">
                                    <p class="text-sm text-gray-600 mb-4">Promote green campus initiatives</p>
                                    <button onclick="selectCandidate('Jordan Taylor')" class="w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-blue-600 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                        Select
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="confirmationSection" class="hidden bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Confirm Your Vote</h3>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600">You are about to vote for:</p>
                            <p id="selectedCandidate" class="font-medium text-blue-600"></p>
                        </div>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-2">Enter your password to confirm:</p>
                            <input type="password" id="walletPassword" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="Wallet password">
                        </div>
                        <button onclick="submitVote()" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                            Submit Vote to Blockchain
                        </button>
                    </div>

                    <div id="successMessage" class="hidden bg-green-50 p-6 rounded-lg border border-green-200">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-green-800">Vote successfully recorded on the blockchain!</h3>
                                <div class="mt-2 text-sm text-green-700">
                                    <p>Transaction Hash: <span id="transactionHash" class="font-mono break-all text-xs">0xf78ac65a80a683c9abff91575872801878376547c7467dc8bc9a88b4346c22a3</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Page -->
        <section id="results" class="py-12 px-4">
            <div class="max-w-7xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Election Results</h2>
                        <p class="text-gray-600">Live results from the blockchain</p>
                    </div>

                    <div class="grid md:grid-cols-1 gap-8 mb-8">
                        <div class="bg-white border p-6 rounded-lg">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Vote Distribution</h3>
                            <div class="space-y-3" id="voteDistributionContainer">
                                <!-- Vote distribution will be dynamically inserted here -->
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Recent Transactions</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead>
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Voter</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate</th>
                                            <th class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 uppercase tracking-wider">Block</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentTransactionsTableBody" class="bg-white divide-y divide-gray-200">
                                        <tr class="transaction-card">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2 min ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">0x7a3...d421</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Alice Chen</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#1829476</td>
                                        </tr>
                                        <tr class="transaction-card">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">5 min ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">0x3f9...a8b7</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">David Martinez</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#1829472</td>
                                        </tr>
                                        <tr class="transaction-card">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">8 min ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">0xbc2...e974</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Alice Chen</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#1829468</td>
                                        </tr>
                                        <tr class="transaction-card">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12 min ago</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">0xe47...d359</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Priya Patel</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">#1829463</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Verify Results on Blockchain</h3>
                        <p class="text-sm text-gray-600 mb-4">You can independently verify the election results by searching the blockchain directly:</p>
                        <div class="flex">
                            <input type="text" id="verifyWalletAddressInput" class="flex-grow px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value="0x742d35Cc6634C0532925a3b844Bc454e4438f44e" readonly>
                            <button onclick="verifyVoteOnBlockchain()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-r-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                Verify
                            </button>
                        </div>
                        <div id="verificationResult" class="mt-4 p-4 bg-white rounded-lg shadow-sm hidden">
                            <h4 class="text-md font-medium text-gray-800 mb-2">Vote Details:</h4>
                            <p class="text-sm text-gray-700"><strong>Voter Address:</strong> <span id="verifiedVoterAddress" class="font-mono"></span></p>
                            <p class="text-sm text-gray-700"><strong>Candidate Voted For:</strong> <span id="verifiedCandidateName"></span></p>
                            <p class="text-sm text-gray-700"><strong>Candidate Affiliation:</strong> <span id="verifiedCandidateParty"></span></p>
                            <p class="text-sm text-gray-700"><strong>Vote Timestamp:</strong> <span id="verifiedVoteTime"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-medium mb-4">BlockVote</h3>
                    <p class="text-sm text-gray-400">A decentralized voting platform built on blockchain technology to ensure transparency, security and integrity in elections.</p>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#home" class="text-sm text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="#vote" class="text-sm text-gray-400 hover:text-white">Vote</a></li>
                        <li><a href="#results" class="text-sm text-gray-400 hover:text-white">Results</a></li>
                        <li><a href="#" class="text-sm text-gray-400 hover:text-white">About Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-medium mb-4">Contact</h3>
                    <address class="text-sm text-gray-400 not-italic">
                        123 Blockchain Street<br>
                        Decentraland, DL 12345<br>
                        <a href="mailto:info@blockvote.org" class="hover:text-white">info@blockvote.org</a>
                    </address>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-gray-700 text-sm text-gray-400 text-center">
                <p>© 2023 BlockVote. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Auth functionality
        let authenticatedUser = null;
        // Store all votes for simulation purposes
        const allVotes = [];
        // Map candidate names to their affiliations
        const candidateAffiliations = {
            'Alice Chen': 'Finance Committee',
            'David Martinez': 'Events Committee',
            'Priya Patel': 'Academic Affairs',
            'Jordan Taylor': 'Sustainability'
        };
        
        function showAuthModal() {
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }
        
        function closeAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
        }
        
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        }
        
        function showSignupForm() {
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
        }
        
        function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Please enter both email and password');
                return;
            }
            
            // Simulate login
            authenticatedUser = {
                email: email,
                walletAddress: '' // Initialize with no wallet address
            };
            
            closeAuthModal(); 
            updateAuthState();
            document.getElementById('app').style.display = 'block';
            document.getElementById('app').style.display = 'block';
        }
        
        function signup() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            // Simulate signup
            authenticatedUser = {
                email: email,
                walletAddress: '' // Initialize with no wallet address
            };
            
            closeAuthModal();
            updateAuthState();
        }

        function connectWallet() {
            if (!authenticatedUser) {
                alert('Please log in or sign up first to connect a wallet.');
                showAuthModal();
                return;
            }
            // Generate a new random wallet address
            authenticatedUser.walletAddress = '0x' + Math.random().toString(16).substr(2, 40);
            alert('New wallet connected: ' + authenticatedUser.walletAddress);
            updateAuthState(); // Update UI with new wallet address
        }
        
        function handleVoteNowClick(event) {
            if (!authenticatedUser) {
                event.preventDefault();
                showAuthModal();
                return false;
            }
            // Update the displayed wallet address on the voting page
            document.getElementById('displayWalletAddress').textContent = authenticatedUser.walletAddress || 'N/A';
            document.getElementById('verifyWalletAddressInput').value = authenticatedUser.walletAddress || ''; // Also update the verify input

            // Show voting status if wallet is connected
            if (authenticatedUser.walletAddress) {
                document.getElementById('votingStatusContainer').classList.remove('hidden');
            } else {
                document.getElementById('votingStatusContainer').classList.add('hidden');
            }
            
            // Already logged in, will scroll to vote section
            return true;
        }

        function updateAuthState() {
            const navLoginButton = document.querySelector('.hidden.md\\:block > button:last-child'); // Selects the Login button
            const navConnectWalletButton = document.querySelector('.hidden.md\\:block .ml-10 > button'); // Selects the Connect Wallet button
            const displayWalletAddress = document.getElementById('displayWalletAddress');
            const verifyWalletAddressInput = document.getElementById('verifyWalletAddressInput');
            const votingStatusContainer = document.getElementById('votingStatusContainer');

            if (authenticatedUser) {
                // Change "Login" button to display email or wallet address
                navLoginButton.textContent = authenticatedUser.email || 'Logged In';
                // Ensure "Connect Wallet" button is visible and its text is appropriate
                navConnectWalletButton.style.display = 'inline-block';
                navConnectWalletButton.textContent = 'Generate New Wallet'; // Change text to reflect its new function
                
                if (authenticatedUser.walletAddress) {
                    displayWalletAddress.textContent = authenticatedUser.walletAddress;
                    verifyWalletAddressInput.value = authenticatedUser.walletAddress;
                    votingStatusContainer.classList.remove('hidden');
                } else {
                    displayWalletAddress.textContent = 'N/A';
                    verifyWalletAddressInput.value = '';
                    votingStatusContainer.classList.add('hidden');
                }
            } else {
                navLoginButton.textContent = 'Login';
                navConnectWalletButton.style.display = 'inline-block';
                navConnectWalletButton.textContent = 'Connect Wallet';
                displayWalletAddress.textContent = 'N/A'; // Clear wallet address if logged out
                verifyWalletAddressInput.value = ''; // Clear verify input if logged out
                votingStatusContainer.classList.add('hidden'); // Hide voting status if logged out
            }
        }

        // Voting functionality
        let selectedCandidate = null;

        function selectCandidate(candidateName) {
            selectedCandidate = candidateName;
            document.getElementById('selectedCandidate').textContent = candidateName;
            document.getElementById('confirmationSection').classList.remove('hidden');
            document.getElementById('successMessage').classList.add('hidden');
            
            // Scroll to confirmation section
            document.getElementById('confirmationSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        function submitVote() {
            const password = document.getElementById('walletPassword').value;
            if (!password) {
                alert('Please enter your wallet password');
                return;
            }

            if (!authenticatedUser || !authenticatedUser.walletAddress) {
                alert('Please log in and connect a wallet before voting.');
                return;
            }

            // Simulate blockchain transaction
            setTimeout(() => {
                document.getElementById('confirmationSection').classList.add('hidden');
                document.getElementById('successMessage').classList.remove('hidden');
                document.getElementById('walletPassword').value = '';
                
                // Generate random transaction hash for demo
                const hash = '0x' + Math.random().toString(16).substr(2, 64);
                document.getElementById('transactionHash').textContent = hash;
                
                // Store the vote data
                const voteData = {
                    voterAddress: authenticatedUser.walletAddress,
                    candidateName: selectedCandidate,
                    candidateParty: candidateAffiliations[selectedCandidate],
                    timestamp: new Date().toLocaleString(),
                    transactionHash: hash
                };
                allVotes.push(voteData);
                console.log('Vote recorded:', voteData); // For debugging

                updateVoteDistributionSection();

                // Add the new vote to the recent votes table
                addRecentTransaction(authenticatedUser.walletAddress, selectedCandidate);
                
                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }, 1500);
        }

        function addRecentTransaction(voterAddress, candidateName) {
            const tableBody = document.getElementById('recentTransactionsTableBody');
            const newRow = document.createElement('tr');
            newRow.classList.add('transaction-card');

            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // e.g., "10:30 AM"
            const simulatedBlock = '#1829' + Math.floor(Math.random() * 1000); // Simulate a new block number

            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${timeString}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">${voterAddress.substring(0, 5)}...${voterAddress.substring(voterAddress.length - 4)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${candidateName}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${simulatedBlock}</td>
            `;
            // Add the new row at the top of the table
            tableBody.prepend(newRow);
        }

        // New function for verifying vote on blockchain
        function verifyVoteOnBlockchain() {
            const walletAddressToVerify = document.getElementById('verifyWalletAddressInput').value;
            const verificationResultDiv = document.getElementById('verificationResult');
            
            const foundVote = allVotes.find(vote => vote.voterAddress === walletAddressToVerify);

            if (foundVote) {
                document.getElementById('verifiedVoterAddress').textContent = foundVote.voterAddress;
                document.getElementById('verifiedCandidateName').textContent = foundVote.candidateName;
                document.getElementById('verifiedCandidateParty').textContent = foundVote.candidateParty;
                document.getElementById('verifiedVoteTime').textContent = foundVote.timestamp;
                verificationResultDiv.classList.remove('hidden');
            } else {
                alert('No vote found for this wallet address. Please ensure you have voted and are using the correct wallet address.');
                verificationResultDiv.classList.add('hidden');
            }
        }

        function updateVoteDistributionSection() {
            const voteDistributionContainer = document.getElementById('voteDistributionContainer');
            voteDistributionContainer.innerHTML = ''; // Clear previous content

            const candidateVotes = {
                'Alice Chen': 0,
                'David Martinez': 0,
                'Priya Patel': 0,
                'Jordan Taylor': 0
            };

            allVotes.forEach(vote => {
                if (candidateVotes.hasOwnProperty(vote.candidateName)) {
                    candidateVotes[vote.candidateName]++;
                }
            });

            const totalVotes = allVotes.length;

            const candidateColors = {
                'Alice Chen': 'blue',
                'David Martinez': 'orange',
                'Priya Patel': 'purple',
                'Jordan Taylor': 'green'
            };

            for (const candidateName in candidateVotes) {
                const votes = candidateVotes[candidateName];
                // Calculate percentage for the progress bar, but display raw vote count
                const percentage = totalVotes === 0 ? 0 : ((votes / totalVotes) * 100).toFixed(1);

                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="flex justify-between text-sm mb-1">
                        <span>${candidateName}</span>
                        <span>${votes} votes</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-${candidateColors[candidateName]}-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                `;
                voteDistributionContainer.appendChild(div);
            }
        }

        function showAllResults() {
            alert('Displaying full election results from blockchain...');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Force authentication before anything else
            if (!authenticatedUser) {
                showAuthModal();
                document.querySelector('main').style.display = 'none';
            }
            updateVoteDistributionSection(); // Initial update of vote distribution

            // Simple router for demo
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    if (!authenticatedUser) {
                        e.preventDefault();
                        showAuthModal();
                        return;
                    }
                    if (this.getAttribute('href').startsWith('#')) {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            target.scrollIntoView({ 
                                behavior: 'smooth' 
                            });
                        }
                    }
                });
            });
            updateAuthState(); // Call updateAuthState on load to set initial button states
        });
    </script>
</body>
</html>